#!/bin/bash

# Couleurs pour le terminal
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
NC='\033[0m' # No Color

# Chemins attendus
TRAIN_SCRIPT="bin/epaphrodites/chatBot/ragFaissModel/train_index.py"
TEXT_DIR="static/docs/base-data"
VECTOR_DIR="bin/database/datas/vector-data"

echo -e "${BLUE}üîç √âtape 1 : V√©rification de la pr√©sence du script d'entra√Ænement...${NC}"
if [ ! -f "$TRAIN_SCRIPT" ]; then
  echo -e "${YELLOW}‚ùå Le fichier $TRAIN_SCRIPT est introuvable ! Assurez-vous qu'il existe.${NC}"
  exit 1
fi
echo -e "${GREEN}‚úÖ train_index.py trouv√©.${NC}"
echo ""

echo -e "${BLUE}üìÅ √âtape 2 : V√©rification des dossiers requis...${NC}"

if [ ! -d "$TEXT_DIR" ]; then
  echo -e "${YELLOW}‚ùå Dossier manquant : $TEXT_DIR${NC}"
  exit 1
else
  echo -e "${GREEN}‚úÖ Dossier texte trouv√© : $TEXT_DIR${NC}"
fi

if [ ! -d "$VECTOR_DIR" ]; then
  echo -e "${YELLOW}‚ùå Dossier manquant : $VECTOR_DIR${NC}"
  exit 1
else
  echo -e "${GREEN}‚úÖ Dossier vectoriel trouv√© : $VECTOR_DIR${NC}"
fi

echo ""
echo -e "${BLUE}‚úÇÔ∏è √âtape 3 : D√©coupage des documents en petits blocs (chunks)...${NC}"
sleep 1

echo ""
echo -e "${BLUE}üß† √âtape 4 : G√©n√©ration des vecteurs d'embedding avec SentenceTransformer...${NC}"
sleep 1

echo ""
echo -e "${BLUE}üì¶ √âtape 5 : Construction de l'index FAISS et sauvegarde des donn√©es...${NC}"
sleep 1

echo ""
echo -e "${GREEN}üöÄ Lancement de l'entra√Ænement...${NC}"
python3 "$TRAIN_SCRIPT"

if [ $? -eq 0 ]; then
  echo ""
  echo -e "${GREEN}‚úÖ Entra√Ænement termin√© avec succ√®s.${NC}"
  echo -e "${GREEN}üìÅ Les fichiers suivants ont √©t√© g√©n√©r√©s dans '${VECTOR_DIR}':${NC}"
  echo -e "${YELLOW}- faiss_index.idx"
  echo -e "- chunks_metadata.npy${NC}"
else
  echo -e "${YELLOW}‚ùå Une erreur est survenue pendant l'entra√Ænement.${NC}"
fi