#!/bin/bash

# Couleur verte pour les messages de succÃ¨s
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Fonction dâ€™attente animÃ©e
wait_animation() {
  echo -n "â³ Please wait"
  for i in {1..3}; do
    sleep 0.5
    echo -n "."
  done
  echo
}

echo "ğŸ”§ [1/7] Moving into build directory..."
cd bin/epaphrodites/cbuild/library || { echo "âŒ Failed to change directory."; exit 1; }
echo -e "${GREEN}âœ… Done${NC}"

echo "ğŸ”— [2/7] Creating symbolic link to config.m4..."
ln -sf ../config/config.m4 .
echo -e "${GREEN}âœ… Link created${NC}"

echo "ğŸ§¹ [3/7] Cleaning previous builds..."
wait_animation
make clean
echo -e "${GREEN}âœ… Cleaned${NC}"

echo "ğŸ§ª [4/7] Running phpize..."
wait_animation
phpize
echo -e "${GREEN}âœ… Phpize completed${NC}"

echo "âš™ï¸ [5/7] Configuring with --enable-schlomo..."
wait_animation
./configure --enable-schlomo
echo -e "${GREEN}âœ… Configuration successful${NC}"

echo "ğŸ”¨ [6/7] Building the extension..."
wait_animation
make
echo -e "${GREEN}âœ… Build successful${NC}"

echo "ğŸ“¦ [7/7] Copying schlomo.so to extension directory..."
cp modules/schlomo.so ../extension/
echo -e "${GREEN}âœ… Extension copied${NC}"

echo -e "${GREEN}ğŸ‰ Script completed successfully!${NC}"